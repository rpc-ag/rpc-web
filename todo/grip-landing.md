# Grip Landing Page Plan

## Objective

Create a new Grip landing page plan grounded in what is already implemented in the Grip codebase, with clear separation between production-facing behavior and roadmap-modeled domains.

## 1) What Grip Does

Grip is a self-hosted tunneling system written in Rust.

Main runtime surfaces:
- `grip` (CLI client)
- `grip-edge` (edge/control-plane service)

Core product behavior implemented today:
- Authenticate CLI against edge with bearer token
- Create/list/delete tunnels via control API v1
- Expose local HTTP services through a shared wildcard endpoint pattern
- Provide operator status output (plain + live TUI)
- Export runtime metrics in Prometheus format

Main entrypoints:
- CLI: `src/main.rs`, `src/cli/*`
- Edge service: `src/bin/grip-edge.rs`
- Control API: `src/control_api/mod.rs`

## 2) Current End-to-End Flow

Typical flow implemented in code/docs:
1. Start `grip-edge` (Docker/systemd/native).
2. Configure seeded token via env (`GRIP_SEED_TOKEN`).
3. Run `grip login --token <TOKEN>`.
4. Run `grip http <PORT>`.
5. CLI creates tunnel (`POST /v1/tunnels`) and can run a local relay.
6. Edge forwards inbound HTTP traffic to configured local destination port.

Public URL pattern generated by CLI:
- `<scheme>://<tunnel-id>.<base-domain><path>`

References:
- `docs/quickstart-one-minute.md`
- `docs/self-host-deployment-guide.md`
- `docs/control-api-v1.md`

## 3) Product/Component Inventory

### A) User-Facing CLI Components

- Commands: `login`, `http`, `tcp`, `status`, `logout`
- Validation and diagnostics (`miette`-style actionable errors)
- Auth token persistence (`~/.grip/token` by default)
- Status modes:
- plain machine-readable output
- live `ratatui` dashboard

Relevant files:
- `src/cli/mod.rs`
- `src/cli/commands/*.rs`
- `src/cli/validation.rs`
- `src/status/mod.rs`
- `tests/cli_help.rs`
- `tests/status_output.rs`

### B) Edge Control-Plane API Components

- Token validation endpoint: `GET /v1/tokens/validate`
- Tunnel lifecycle endpoints:
- `POST /v1/tunnels`
- `GET /v1/tunnels`
- `DELETE /v1/tunnels/:tunnel_id`
- Stable JSON error envelope (`CONTROL_*` codes + remediation help)
- Idempotency enforcement on mutating endpoints
- Endpoint naming/collision policy and ownership audit events

Relevant files:
- `src/control_api/mod.rs`
- `src/domain/control_plane_idempotency.rs`
- `src/endpoint_policy/mod.rs`
- `docs/control-api-v1.md`
- `tests/control_api.rs`
- `tests/control_api_contract.rs`

### C) Ingress/Routing + Forwarding Components

- Host/path routing primitives and route precedence logic
- Offline tunnel unavailable contract (`INGRESS_TUNNEL_OFFLINE`)
- Overload mapping contracts
- HTTP proxying path in edge (`reqwest` upstream forwarding)

Relevant files:
- `src/ingress/mod.rs`
- `src/overload/mod.rs`
- `src/control_api/mod.rs` (proxy handlers)
- `docs/ingress-route-resolution.md`
- `tests/ingress_routing.rs`

### D) Runtime + Reliability Foundation Components

- Actor model skeleton and worker graph
- Mailbox capacity profiles and mailbox mode transitions
- Supervision/restart strategy mapping
- Graceful shutdown coordinator with timeout fallback
- Ingress fairness limiter + per-session token bucket
- Saturation guardrail and overload action classification
- Reconnect backoff with jitter + needs-attention terminal state

Relevant files:
- `src/runtime/actor.rs`
- `src/runtime/actor_graph.rs`
- `src/runtime/supervision.rs`
- `src/runtime/ingress.rs`
- `src/runtime/saturation.rs`
- `src/reconnect/mod.rs`

### E) Transport, Persistence, and Introspection Components

- Transport adapter abstraction (`QUIC`, `WebSocket`)
- Transport profiles (`dev`, `default`, `high-throughput`)
- Buffer pool with reuse metrics
- Data-plane header schema (`rkyv`/`bytecheck`) + decode classification
- Persistence write actor with batch commit policy
- Replay stream windowing/caps/backpressure timeout behavior
- Bounded introspection executor with concurrency/time/memory/CPU budgets
- Reflection cache with TTL + capacity limits

Relevant files:
- `src/transport/*`
- `src/persistence/mod.rs`
- `src/introspection/decode.rs`
- `src/introspection/execution.rs`
- `src/introspection/cache.rs`

### F) Observability and Diagnostics Components

- Prometheus exporter (`/metrics`) with stable schema version metric
- Transport/persistence/reconnect/decode counters and gauges
- Latency attribution histograms (stage decomposition)
- Persistence commit/replay latency histograms and percentiles
- Structured logs with redaction helper
- Profile-based tracing config and optional `tokio-console`

Relevant files:
- `src/metrics/*`
- `src/runtime/observability.rs`
- `src/runtime/async_debug.rs`
- `docs/status-dashboard.md`
- `docs/phase03-telemetry-schema.md`

### G) Governance and Advanced Domain Modules (Phase 04-heavy)

These modules exist as concrete domain logic/contracts and are heavily tested/documented:
- Workspace/project hierarchy
- RBAC templates and policy bindings
- Scoped token governance + rotation
- Compliance export snapshots
- Region registry, weighted routing, brownout/failover decisions
- SLO gate automation
- Chaos/adversarial gate evaluation
- DR game-day validation
- Consistency contract validation
- Migration assistant + cookbook + import/export schema
- Plugin SDK contract + hook lifecycle
- Compatibility profile/reporting

Relevant files (examples):
- `src/domain/workspace_hierarchy.rs`
- `src/domain/rbac.rs`
- `src/domain/token_governance.rs`
- `src/domain/compliance_export.rs`
- `src/domain/region_registry.rs`
- `src/domain/weighted_routing.rs`
- `src/domain/slo_gate_automation.rs`
- `src/domain/chaos_suite.rs`
- `src/domain/migration_assistant.rs`
- `src/domain/plugin_sdk_contract.rs`

## 4) Production-Facing Now vs Modeled for Roadmap

Production-facing today (wired into binaries):
- CLI command surface
- Edge control API + token validation
- HTTP forwarding path
- Status output surfaces
- Metrics and tracing setup
- Deployment artifacts (Docker, systemd + Caddy docs)

Important current constraints:
- Control-plane tunnel state is in-memory (edge restart clears active tunnels)
- Shared wildcard endpoint flow is primary path
- TCP tunnel lifecycle exists in API/CLI, but forwarding implementation is HTTP-focused in current edge proxy path

References:
- `docs/production-deployment-guide.md`
- `docs/endpoint-strategy.md`

## 5) Landing-Page-Ready Component Framing

Top-level sections to use in page IA/copy:
- Self-hosted tunneling core
- Deterministic control API contracts
- Reliability guardrails (backpressure, replay limits, reconnect policy)
- Operator observability (metrics, structured logs, live status)
- Security/governance foundation (token scope, RBAC, auditing)
- Migration/extensibility path (import/export + plugin SDK contracts)
- Deployment flexibility (Docker dev, systemd + Caddy production)

## 6) Evidence Density (Credibility Points)

- `src` Rust files: 82
- `tests` Rust files: 274
- `docs` markdown files: 128
- Domain modules: 28
- Runtime modules: 16
- Transport modules: 8

Positioning implication:
- Strong material to emphasize reliability engineering depth
- Strong material to emphasize operator-first workflows
- Strong material to emphasize self-hosted control

## 7) Page Execution TODO (rpc-web)

- [ ] Create new route/page for Grip in web app (parallel to existing Gateway product page pattern).
- [ ] Build hero section around "self-hosted Rust tunneling" and explicit CLI + edge architecture.
- [ ] Add "How it works" step flow using implemented sequence:
1. Start `grip-edge`
2. Seed token with `GRIP_SEED_TOKEN`
3. `grip login --token <TOKEN>`
4. `grip http <PORT>`
5. Control API tunnel creation
6. Edge forwarding to local service
- [ ] Add capabilities sections mapped to inventories A-G above (CLI, API, ingress, runtime, transport/persistence/introspection, observability, governance).
- [ ] Add protocol/contract callouts for:
- `GET /v1/tokens/validate`
- `POST /v1/tunnels`
- `GET /v1/tunnels`
- `DELETE /v1/tunnels/:tunnel_id`
- `CONTROL_*` error envelope and idempotency behavior
- [ ] Add observability callouts:
- `/metrics` exporter
- status output modes (plain + live TUI)
- tracing/logging details
- [ ] Add reliability callouts:
- supervision/restart strategy
- saturation guardrails
- ingress fairness + per-session token bucket
- reconnect jitter/backoff and terminal needs-attention state
- [ ] Add governance/foundation section that clearly labels advanced modules as existing contracts/domain logic and avoids over-claiming current runtime wiring.
- [ ] Add deployment section for Docker/systemd+Caddy options.
- [ ] Add proof-strip with repo evidence counts (82/274/128/28/16/8).
- [ ] Add constraints note block to keep claims precise:
- in-memory tunnel state today
- wildcard endpoint primary flow
- TCP lifecycle exists but forwarding currently HTTP-focused
- [ ] Ensure every marketing claim can be traced to listed source files/docs in this plan.

## 8) Copy Guardrails

- Prefer "self-hosted", "deterministic contracts", and "operator-first" language.
- Keep production claims limited to currently wired paths.
- Present Phase 04-heavy modules as concrete, tested domain foundations without implying all are active in the default runtime path today.
- Keep proof points tied to documented modules/tests/docs counts.

## 9) Source Reference Index

- `src/main.rs`
- `src/cli/*`
- `src/bin/grip-edge.rs`
- `src/control_api/mod.rs`
- `docs/quickstart-one-minute.md`
- `docs/self-host-deployment-guide.md`
- `docs/control-api-v1.md`
- `src/cli/mod.rs`
- `src/cli/commands/*.rs`
- `src/cli/validation.rs`
- `src/status/mod.rs`
- `tests/cli_help.rs`
- `tests/status_output.rs`
- `src/domain/control_plane_idempotency.rs`
- `src/endpoint_policy/mod.rs`
- `tests/control_api.rs`
- `tests/control_api_contract.rs`
- `src/ingress/mod.rs`
- `src/overload/mod.rs`
- `docs/ingress-route-resolution.md`
- `tests/ingress_routing.rs`
- `src/runtime/actor.rs`
- `src/runtime/actor_graph.rs`
- `src/runtime/supervision.rs`
- `src/runtime/ingress.rs`
- `src/runtime/saturation.rs`
- `src/reconnect/mod.rs`
- `src/transport/*`
- `src/persistence/mod.rs`
- `src/introspection/decode.rs`
- `src/introspection/execution.rs`
- `src/introspection/cache.rs`
- `src/metrics/*`
- `src/runtime/observability.rs`
- `src/runtime/async_debug.rs`
- `docs/status-dashboard.md`
- `docs/phase03-telemetry-schema.md`
- `src/domain/workspace_hierarchy.rs`
- `src/domain/rbac.rs`
- `src/domain/token_governance.rs`
- `src/domain/compliance_export.rs`
- `src/domain/region_registry.rs`
- `src/domain/weighted_routing.rs`
- `src/domain/slo_gate_automation.rs`
- `src/domain/chaos_suite.rs`
- `src/domain/migration_assistant.rs`
- `src/domain/plugin_sdk_contract.rs`
- `docs/production-deployment-guide.md`
- `docs/endpoint-strategy.md`
